---
phase: 02-team-size-aware-analysis
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/confidence-badge.tsx
  - src/components/gap-card.tsx
  - src/components/gap-analysis.tsx
  - src/components/health-card.tsx
  - src/app/xray/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Results page shows a team context banner when teamSize is present (e.g., 'Calibrated for 3-person team')"
    - "Each gap card displays a confidence indicator badge ('High Confidence' or 'Inferred')"
    - "Health card shows whether scores are team-calibrated or using defaults"
    - "Gap analysis section header includes team context when available"
    - "All new UI elements gracefully handle missing data (old workflows without teamSize/confidence render normally)"
  artifacts:
    - path: "src/components/confidence-badge.tsx"
      provides: "Reusable confidence indicator badge component"
      exports: ["ConfidenceBadge"]
    - path: "src/components/gap-card.tsx"
      provides: "Gap card with confidence indicator"
      contains: "confidence"
    - path: "src/components/gap-analysis.tsx"
      provides: "Gap analysis with team context header"
      contains: "teamSize"
    - path: "src/components/health-card.tsx"
      provides: "Health card with team calibration context"
      contains: "teamSize"
    - path: "src/app/xray/[id]/page.tsx"
      provides: "Results page with team context banner"
      contains: "Calibrated for"
  key_links:
    - from: "src/components/gap-card.tsx"
      to: "src/components/confidence-badge.tsx"
      via: "import ConfidenceBadge"
      pattern: "ConfidenceBadge"
    - from: "src/components/health-card.tsx"
      to: "src/components/confidence-badge.tsx"
      via: "import ConfidenceBadge"
      pattern: "ConfidenceBadge"
    - from: "src/app/xray/[id]/page.tsx"
      to: "workflow.costContext?.teamSize"
      via: "conditional rendering"
      pattern: "costContext.*teamSize"
---

<objective>
Build the UI layer that displays team-size context and confidence indicators across the results page: a reusable confidence badge component, team context banners on the results page and health card, and per-gap confidence indicators.

Purpose: Without visible team-size context and confidence indicators, users cannot see what calibration was applied (TEAM-04) or where the AI is certain vs. estimating (TEAM-05). This plan makes the team-size analysis visible and interpretable.

Output: ConfidenceBadge component, updated gap-card with confidence, updated gap-analysis with team header, updated health-card with calibration context, updated xray page with team banner.
</objective>

<execution_context>
@C:/Users/Brian/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Brian/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-team-size-aware-analysis/02-RESEARCH.md
@.planning/phases/02-team-size-aware-analysis/02-01-SUMMARY.md

@src/components/gap-card.tsx
@src/components/gap-analysis.tsx
@src/components/health-card.tsx
@src/app/xray/[id]/page.tsx
@src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConfidenceBadge component and update gap-card with confidence indicator</name>
  <files>
    src/components/confidence-badge.tsx
    src/components/gap-card.tsx
  </files>
  <action>
Create `src/components/confidence-badge.tsx`:

A small, reusable "use client" component matching the existing codebase style (inline styles, CSS custom properties, no Tailwind classes):

```typescript
interface ConfidenceBadgeProps {
  level: "high" | "inferred";
  context?: string; // tooltip text
}
```

Render a `<span>` with:
- `title={context}` for tooltip
- Font: `var(--font-mono)`, size 9px, weight 700, uppercase, letter-spacing 0.06em
- Padding: 2px 8px, border-radius 10
- For "high": green coloring -- background: `var(--success-bg-light)`, color: `var(--color-success)`, border: `1px solid rgba(23,165,137,0.2)`. Text: "High Confidence"
- For "inferred": amber/warning coloring -- background: `rgba(212,160,23,0.08)`, color: `var(--color-warning)`, border: `1px solid rgba(212,160,23,0.2)`. Text: "Inferred"

This matches the existing badge/tag pattern used throughout the codebase (see ROI metadata tags in gap-card.tsx).

Then update `src/components/gap-card.tsx`:

1. Import `ConfidenceBadge` from `./confidence-badge`.

2. In the header area (the `<button>` that shows gap type label and severity), add the ConfidenceBadge BETWEEN the gap type label and the severity pill. Only render if `gap.confidence` exists:

```tsx
{gap.confidence && (
  <ConfidenceBadge
    level={gap.confidence}
    context={gap.confidence === "high"
      ? "This gap is clearly evidenced from the workflow description"
      : "This gap is estimated based on typical patterns"}
  />
)}
```

3. Position it in the existing flex layout by adding it to the left side `<div>` (with the icon and label), after the label span. The flex layout with `gap: 10` will handle spacing naturally.

IMPORTANT: Use conditional rendering (`gap.confidence &&`) so old workflows without the confidence field render exactly as before.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Read both files to confirm the ConfidenceBadge component exists and gap-card conditionally renders it. Verify that the GapCardProps interface still uses the `Gap` type from types.ts (which now has optional confidence).
  </verify>
  <done>
ConfidenceBadge component renders "High Confidence" (green) or "Inferred" (amber) badge. Gap card displays confidence badge in header when gap.confidence is present. Old workflows without confidence field render unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add team context to gap-analysis header, health-card, and xray results page</name>
  <files>
    src/components/gap-analysis.tsx
    src/components/health-card.tsx
    src/app/xray/[id]/page.tsx
  </files>
  <action>
Update `src/components/gap-analysis.tsx`:

1. Add optional `teamSize` and `teamContext` props to `GapAnalysisProps`:
   ```typescript
   interface GapAnalysisProps {
     gaps: Gap[];
     teamSize?: number;
     teamContext?: string;
   }
   ```

2. Before the severity badge row (the div with high/medium/low badges), add a team context header when teamSize is available:
   ```tsx
   {teamSize && (
     <div style={{
       display: "flex",
       alignItems: "center",
       gap: 8,
       padding: "8px 14px",
       background: "rgba(45,125,210,0.04)",
       border: "1px solid rgba(45,125,210,0.12)",
       borderRadius: "var(--radius-sm)",
       marginBottom: 12,
       fontFamily: "var(--font-mono)",
       fontSize: 11,
     }}>
       <span style={{ fontWeight: 600, color: "var(--color-info)" }}>
         Gap severity calibrated for {teamSize}-person team
       </span>
       {teamContext && (
         <span style={{ color: "var(--color-muted)", fontFamily: "var(--font-body)" }}>
           ({teamContext})
         </span>
       )}
     </div>
   )}
   ```

Update `src/components/health-card.tsx`:

3. Add optional `teamSize` and `confidence` props to `HealthCardProps`:
   ```typescript
   interface HealthCardProps {
     health: HealthMetrics;
     stepCount: number;
     gapCount: number;
     teamSize?: number;
     confidence?: { level: "high" | "inferred"; reason: string };
   }
   ```

4. Import `ConfidenceBadge` from `./confidence-badge`.

5. After the "Health Breakdown" label (inside the detailed bars section), add a team calibration context line when teamSize or confidence is available:
   ```tsx
   {(teamSize || confidence) && (
     <div style={{
       display: "flex",
       alignItems: "center",
       gap: 8,
       marginBottom: 12,
       padding: "6px 12px",
       background: "rgba(45,125,210,0.04)",
       borderRadius: "var(--radius-sm)",
       border: "1px solid rgba(45,125,210,0.08)",
     }}>
       {teamSize && (
         <span style={{
           fontFamily: "var(--font-mono)",
           fontSize: 10,
           fontWeight: 600,
           color: "var(--color-info)",
         }}>
           Scores calibrated for {teamSize}-person team
         </span>
       )}
       {confidence && (
         <ConfidenceBadge level={confidence.level} context={confidence.reason} />
       )}
     </div>
   )}
   ```

Update `src/app/xray/[id]/page.tsx`:

6. After the header tags row (the flex container with Tag components for steps/gaps/automatable%) and BEFORE the version timeline, add a team context banner:
   ```tsx
   {workflow.costContext?.teamSize && (
     <div style={{
       display: "flex",
       alignItems: "center",
       gap: 8,
       padding: "8px 14px",
       background: "rgba(45,125,210,0.04)",
       border: "1px solid rgba(45,125,210,0.12)",
       borderRadius: "var(--radius-sm)",
       marginTop: 12,
       animation: "fadeInUp 0.4s var(--ease-spring) 0.05s both",
     }}>
       <span style={{
         fontFamily: "var(--font-mono)",
         fontSize: 11,
         fontWeight: 600,
         color: "var(--color-info)",
       }}>
         Calibrated for {workflow.costContext.teamSize}-person team
       </span>
       {workflow.costContext.teamContext && (
         <span style={{
           fontFamily: "var(--font-body)",
           fontSize: 11,
           color: "var(--color-muted)",
         }}>
           ({workflow.costContext.teamContext})
         </span>
       )}
     </div>
   )}
   ```

7. Pass teamSize and teamContext to GapAnalysis:
   ```tsx
   {activeTab === "gaps" && (
     <GapAnalysis
       gaps={decomposition.gaps}
       teamSize={workflow.costContext?.teamSize}
       teamContext={workflow.costContext?.teamContext}
     />
   )}
   ```

8. Pass teamSize and confidence to HealthCard:
   ```tsx
   {activeTab === "health" && (
     <HealthCard
       health={decomposition.health}
       stepCount={decomposition.steps.length}
       gapCount={decomposition.gaps.length}
       teamSize={workflow.costContext?.teamSize}
       confidence={decomposition.health.confidence}
     />
   )}
   ```

IMPORTANT: All rendering is conditional on the field existing. Old workflows without costContext, teamSize, or confidence will render exactly as they do today -- no visual changes for legacy data.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Read all modified files to confirm:
- GapAnalysis accepts and renders teamSize/teamContext
- HealthCard accepts and renders teamSize/confidence with ConfidenceBadge
- xray page renders team context banner and passes props to child components
- All new rendering is conditional (uses && short-circuit)
  </verify>
  <done>
Team context banner appears on xray results page when teamSize is present. Gap analysis shows "Gap severity calibrated for N-person team" header. Health card shows calibration context with confidence badge. All UI elements are conditionally rendered -- old workflows without team data render unchanged.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `confidence-badge.tsx` exists and exports a reusable badge component
3. gap-card.tsx conditionally renders ConfidenceBadge when gap.confidence exists
4. gap-analysis.tsx shows team context header when teamSize prop is provided
5. health-card.tsx shows calibration context and ConfidenceBadge when props are provided
6. xray/[id]/page.tsx renders team context banner and passes teamSize/confidence to child components
7. Loading an old workflow (without teamSize/confidence) renders identically to before -- no visual regressions
</verification>

<success_criteria>
- ConfidenceBadge component exists with high (green) and inferred (amber) visual states
- Results page displays team size context banner above analysis tabs
- Gap cards show per-gap confidence indicators
- Health card shows calibration context with overall confidence badge
- Gap analysis section shows team-calibrated severity header
- All UI changes are backward compatible (conditional rendering for missing fields)
- TypeScript compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-team-size-aware-analysis/02-03-SUMMARY.md`
</output>
